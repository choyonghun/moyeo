<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>모여</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/webjars/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <script src="/webjars/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

  <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <!-- include summernote css/js -->
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>

  <style>
    body {
      padding-left: 10px;
    }
  </style>
</head>

<div data-th-replace="header :: header">머리말</div>

<body>
<h2>모집 게시판</h2>

<form action="update" data-th-action="@{update}" method="post" enctype='multipart/form-data' data-th-object="${board}">
  <input type="hidden" name="recruitBoardId" data-th-value="*{recruitBoardId}">
  <div>
    제목: <input name="title" type="text" data-th-value="*{title}">
  </div>
  <div>
    상태: <input name="state" type="radio" data-th-checked="*{state == true}" value="true">모집중
    <input name="state" type="radio" data-th-checked="*{state == false}" value="false">마감
  </div>
  <div>
    마감일: <input name="deadline" type="date" data-th-value=*{deadline}>
  </div>
  <div>
    여행일자: <input name="startDate" type="date" data-th-value=*{startDate}> ~ <input name="endDate" type="date" data-th-value=*{endDate}>
  </div>
  <div>
    모집인원: <input name="recruitTotal" type="number" min="2" max="20" value="2" data-th-value="*{recruitTotal}">
  </div>
  <div>
    지역:
    <label for="regionId"></label>
    <select name="regionId" id="regionId">
      <option value="0">=== 선택 ===</option>
      <option value="1">서울</option>
      <option value="2">부산</option>
      <option value="3">대구</option>
      <option value="4">인천</option>
    </select>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        let dropdown = document.getElementById("regionId");
        let condition = [[${board.region.regionId}]];

        switch (condition) {
          case 1:
            dropdown.value = "1";
            break;
          case 2:
            dropdown.value = "2";
            break;
          case 3:
            dropdown.value = "3";
            break;
          case 4:
            dropdown.value = "4";
            break;
          default:
            dropdown.value = "0";
            break;
        }
      });
    </script>

  </div>
  <div>
    테마:
    <label for="themeId"></label>
    <select name="themeId" id="themeId">
      <option value="0">=== 선택 ===</option>
      <option value="1">힐링여행</option>
      <option value="2">캠핑여행</option>
      <option value="3">액티비티여행</option>
    </select>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        let dropdown = document.getElementById("themeId");
        let condition = [[${board.theme.themeId}]];

        switch (condition) {
          case 1:
            dropdown.value = "1";
            break;
          case 2:
            dropdown.value = "2";
            break;
          case 3:
            dropdown.value = "3";
            break;
          default:
            dropdown.value = "0";
            break;
        }
      });
    </script>

  </div>
  <div>
    내용: <textarea id="summernote" name="content" data-th-text=*{content}></textarea>
  </div>
  <div>
    위도: <input name="latitude" type="text" data-th-value=*{latitude}>
  </div>
  <div>
    경도: <input name="longitude" type="text" data-th-value=*{longitude}>
  </div>
  <div>
  </div>
  <div>
    <button>등록</button>
    <a href="list.html">취소</a>
  </div>
</form>

<script>

  $(document).ready(function() {
    $('#summernote').summernote({
      height: 300,
      width: 900,
      callbacks: {
        onInit: function() {
          console.log('Summernote 생성됨!');
        },
        onImageUpload: function(files) {  // 사용자 지정 메서드

          let data = new FormData();
          for (const file of files) {
            data.append("files", file);
          }
          $.ajax({
            url: 'file/upload', // 절대경로: http://localhost:8888/recruit/file/upload
            type: 'POST',
            dataType: 'json',
            contentType: false,
            processData: false,
            data: data
          })
          .done(function(result) {
            if (result.length == 0) {
              alert('로그인 하세요!');
              return;
            }

            // 서버에서 받은 업로드 파일 이름을 가지고 <img> 태그를 설정한다.
            for (const recruitPhoto of result) {
              $('#summernote').summernote('insertImage',
                'https://kr.object.ncloudstorage.com/moyeo-bucket/recruit/'
                + recruitPhoto.photo);
            }
          });

        }
      }
    });
  });


</script>

</body>

<div data-th-replace="footer :: footer">꼬리말</div>

</html>